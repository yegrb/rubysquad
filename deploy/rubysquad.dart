import "dart:html" as h;class FD{static const  GD="Chrome";static const  HD="Firefox";static const  ID="Internet Explorer";static const  JD="Safari";final  rC;final  minimumVersion;const FD(this.rC,[this.minimumVersion]);}class KD{final  name;const KD(this.name);}class iB{var canvas;var j;var ND;iB(){OD();PD();} OD(){canvas=h.query(".game-canvas");var i=canvas.context2D;j=new o(canvas);j.IB=( l){};j.HB=(( g){g.bB;});} PD(){ND=new h.WebSocket("ws://${h.window.location.hostname}:${h.window.location.port}/ws");} start(){j.start();ND.onMessage.listen(( g){h.query(".msg").text="Received pong!";});ND.onOpen.listen((QD){ND.send("ping");});}} main(){var g=new iB();g.start();}abstract class RB{ get x; get y; get dx; get dy; get time; get k;}class SB{final  p;var cB=0;var dB=0;var zC=0.0;var AD=0.0;SB(this.p); get q=>cB>dB;}typedef  jB( gameLoop);abstract class m{var s=0.015;var GB=0.03; get k; get eB; get bB=>s;static  CB(g)=>g/1000.0; get time=>CB(new DateTime.now().millisecondsSinceEpoch);m(){} wC(){var RD=SD.length;for(int g=0;g<RD;g++ ){SD[g].TD(bB);}for(int g=SD.length-1;g>=0;g-- ){var i=SD.length-1;if(SD[g].UD){if(g!=i){SD[g]=SD[i];}SD.removeLast();}}} start();final  SD=new List<kB>();var IB;}class kB{kB();}class lB{lB();}class TB{final  q;final  k;final  p;final  time;TB(this.p,this.q,this.k,this.time); toString()=>'Button: ${p} DOWN: ${q} [${k}@${time}]';}class DB{final  j;final  buttons=new Map<int,SB>();DB(this.j, i){for(int g in i){buttons[g]=new SB(g);}} aB( i){var g=buttons[i.p];if(g==null){return;}if(i.q){if(g.q==false){g.cB=i.k;g.zC=i.time;}}else{g.dB=i.k;g.AD=i.time;}}}class nB{final  x;final  y;final  dx;final  dy;final  EB;final  FB;final  time;final  JB;final  k;nB(this.x,this.y,this.dx,this.dy,this.EB,this.FB,this.JB,this.time,this.k);}class mB{final  j;mB(this.j){j.element.onClick.listen(VD);h.document.onPointerLockChange.listen(WD);} xC(){j.element.requestPointerLock();} VD( g){if(tC){xC();}}var tC=true; WD( g){if(j.onPointerLockChange!=null){j.onPointerLockChange(j);}}}class n{static const UB=0x1;static const VB=0x2;static const WB=0x3;final  event;final  type;n(this.event,this.type);}class oB{final  j;var buttons;var MD;oB(this.j){}}typedef  pB( gameLoop);class qB extends DB{static const rB=h.KeyCode.A;static const tB=h.KeyCode.B;static const uB=h.KeyCode.C;static const vB=h.KeyCode.D;static const xB=h.KeyCode.E;static const yB=h.KeyCode.F;static const zB=h.KeyCode.G;static const BC=h.KeyCode.H;static const CC=h.KeyCode.I;static const EC=h.KeyCode.J;static const GC=h.KeyCode.K;static const IC=h.KeyCode.L;static const KC=h.KeyCode.M;static const MC=h.KeyCode.N;static const NC=h.KeyCode.O;static const OC=h.KeyCode.P;static const PC=h.KeyCode.Q;static const QC=h.KeyCode.R;static const RC=h.KeyCode.S;static const SC=h.KeyCode.T;static const TC=h.KeyCode.U;static const UC=h.KeyCode.V;static const VC=h.KeyCode.W;static const WC=h.KeyCode.X;static const XC=h.KeyCode.Y;static const YC=h.KeyCode.Z;static const ZC=h.KeyCode.SHIFT;static const aC=h.KeyCode.CTRL;static const bC=h.KeyCode.ALT;static const cC=h.KeyCode.SPACE;static const dC=h.KeyCode.ZERO;static const eC=h.KeyCode.ONE;static const fC=h.KeyCode.TWO;static const gC=h.KeyCode.THREE;static const hC=h.KeyCode.FOUR;static const iC=h.KeyCode.FIVE;static const jC=h.KeyCode.SIX;static const kC=h.KeyCode.SEVEN;static const lC=h.KeyCode.EIGHT;static const mC=h.KeyCode.NINE;static const nC=h.KeyCode.TILDE;static const oC=h.KeyCode.ENTER;static const pC=h.KeyCode.UP;static const qC=h.KeyCode.DOWN;static const DC=h.KeyCode.LEFT;static const HC=h.KeyCode.RIGHT;static final  JC=[rB,tB,uB,vB,xB,yB,zB,BC,CC,EC,GC,IC,KC,MC,NC,OC,PC,QC,RC,SC,TC,UC,VC,WC,XC,YC,ZC,aC,bC,cC,dC,eC,fC,gC,hC,iC,jC,kC,lC,mC,nC,oC,pC,qC,DC,HC];qB(g):super(g,JC);}typedef  sB( gameLoop);class XB implements RB{final  x;final  y;final  dx;final  dy;final  time;final  k;XB(this.x,this.y,this.dx,this.dy,this.time,this.k);}typedef  wB( gameLoop);typedef  AC( gameLoop);class YB extends DB implements RB{static const DC=0;static const FC=1;static const HC=2;static final  JC=[DC,FC,HC];var ZD=0; get dx=>ZD;var dD=0; get dy=>dD;var hD=0; get x=>hD;var iD=0; get y=>iD;var jD=0; get EB=>jD;var mD=0; get FB=>mD;var nD=0;var qD=0;var sD=false; get JB=>sD;var uD=0.0; get time=>uD;var wD=0; get k=>wD;YB(g):super(g,JC); sC( g){hD=g.x;iD=g.y;uD=g.time;wD=g.k;ZD+= g.dx;dD+= g.dy;jD=g.EB;mD=g.FB;sD=g.JB;} BE( i, g){nD+= i;qD+= g;} DE(){nD=0;qD=0;ZD=0;dD=0;}}typedef  ZB( gameLoop, touch);class t{final  id;final  vC=new List<XB>();t(this.id);}class o extends m{final  element;var XD=0;var YD=false;var aD=false;var bD;var cD=0.0;var eD=false;var fD=0.0; get k=>XD;var GB=0.03;var kD=0.0; get width=>element.client.width; get height=>element.client.height;var oD=0.0; get eB=>oD;var pD=0.0;var yC=0.05;var tD;var vD;var xD; get uC=>xD;var yD;var AE;o(this.element):super(){vD=new qB(this);xD=new YB(this);yD=new oB(this);tD=new mB(this);AE=new LC(this);} CE(){for(h.KeyboardEvent KB in EE){var i;var LB=KB.type=="keydown";var l=m.CB(KB.timeStamp);var MB=KB.keyCode;i=new TB(MB,LB,k,l);vD.aB(i);}EE.clear();uC.DE();var NB=element.offset.left;var OB=element.offset.top;for(h.MouseEvent g in FE){var BD=g.type=='mousemove';var CD=g.type=='mousewheel';var LB=g.type=='mousedown';var l=m.CB(g.timeStamp);if(BD){var PB=g.page.x;var QB=g.page.y;var fB=PB-NB;var gB=QB-OB;var v=0;var w=0;var AB=false;if(PB<NB){v=0;}else if(PB>NB+width){v=width;}else{v=fB;AB=true;}if(QB<OB){w=0;AB=false;}else if(QB>OB+height){w=height;AB=false;}else{w=gB;}var DD=g.movement.x;var ED=g.movement.y;var i=new nB(fB,gB,DD,ED,v,w,AB,l,k);xD.sC(i);}else if(CD){var hB=g as h.WheelEvent;xD.BE(hB.deltaX,hB.deltaY);}else{var MB=g.button;var i=new TB(MB,LB,k,l);xD.aB(i);}}FE.clear();for(n BB in GE){switch (BB.type){case n.WB:AE.lD(BB.event);break;case n.VB:AE.rD(BB.event);break;case n.UB:AE.zD(BB.event);break;default:throw new StateError('Invalid _GameLoopTouchEven type.');}}GE.clear();}var HE; IE( JE){if(bD==null){cD=time;bD=cD;CE();HE=h.window.requestAnimationFrame(IE);return;}if(aD==true){HE=null;return;}HE=h.window.requestAnimationFrame(IE);XD++ ;bD=cD;cD=time;var g=cD-bD;kD+= g;if(kD>GB){kD=GB;}CE();while (kD>=s){wC();oD+= s;if(IB!=null){IB(this);}kD-= s;}if(eD==true&&onResize!=null&&fD<=cD){onResize(this);fD=cD+yC;eD=false;}if(HB!=null){pD=kD/s;HB(this);}} KE( JE){if(onFullscreenChange==null){return;}onFullscreenChange(this);} LE( JE){if(onFullscreenChange==null){return;}onFullscreenChange(this);}final  GE=new List<n>(); ME( g){GE.add(new n(g,n.WB));} NE( g){GE.add(new n(g,n.UB));} OE( g){GE.add(new n(g,n.VB));}final  EE=new List<h.KeyboardEvent>(); PE( g){EE.add(g);} QE( g){EE.add(g);}final  FE=new List<h.MouseEvent>(); RE( g){FE.add(g);} SE( g){FE.add(g);} TE( g){FE.add(g);} UE( g){FE.add(g);g.preventDefault();} VE( JE){if(eD==false){eD=true;}} start(){if(YD==false){h.document.onFullscreenError.listen(LE);h.document.onFullscreenChange.listen(KE);h.window.onTouchStart.listen(ME);h.window.onTouchEnd.listen(OE);h.window.onTouchMove.listen(NE);h.window.onKeyDown.listen(PE);h.window.onKeyUp.listen(QE);h.window.onResize.listen(VE);h.window.onMouseMove.listen(TE);h.window.onMouseDown.listen(RE);h.window.onMouseUp.listen(SE);h.window.onMouseWheel.listen(UE);YD=true;}aD=false;HE=h.window.requestAnimationFrame(IE);}var HB;var onResize;var onFullscreenChange;var onPointerLockChange;var onTouchStart;var onTouchEnd;}class LC{final  u=new Map<int,t>();final  j;LC(this.j); gD( l, g){var i=new XB(g.client.x,g.client.y,0,0,j.eB,j.k);l.vC.add(i);} lD( l){l.changedTouches.forEach(( g){var i=new t(g.identifier);u[g.identifier]=i;gD(i,g);if(j.onTouchStart!=null){j.onTouchStart(j,i);}});} rD( l){l.changedTouches.forEach(( g){var i=u[g.identifier];u.remove(g.identifier);gD(i,g);if(j.onTouchEnd!=null){j.onTouchEnd(j,i);}});} zD( i){i.changedTouches.forEach(( g){var l=u[g.identifier];gD(l,g);});}}